<!DOCTYPE html>
<html>
<head>
  <style>
    .grid-container {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 5px;
      max-width: 520px;
      margin: 0 auto;
    }

    .square {
      width: 100%;
      padding-top: 100%;
      position: relative;
    }

    .square img {
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
    }
  </style>
</head>
<body>
  <div class="grid-container" id="minesweeper">
    <!-- Quadrados serão adicionados aqui dinamicamente -->
  </div>

  <script>
    const lugarOcultoPath = '../assets/svg/LugarOculto.svg';
    const lugarEscolhidoPath = '../assets/svg/LugarEscolhido.svg';

    const defaultBoardState = Array(25).fill(lugarOcultoPath);
    let currentBoardState = [];

    // Função para embaralhar o array de lugares
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // Função para criar e carregar o tabuleiro
    function loadBoard(lugares) {
      const gridContainer = document.getElementById('minesweeper');
      gridContainer.innerHTML = '';

      lugares.forEach((lugar) => {
        const square = document.createElement('div');
        square.classList.add('square');

        const img = document.createElement('img');
        img.src = lugar;
        img.alt = 'Lugar';

        square.appendChild(img);
        gridContainer.appendChild(square);
      });

      currentBoardState = lugares;
    }

    // Função para salvar o estado atual do tabuleiro no localStorage
    function saveBoardState() {
      localStorage.setItem('boardState', JSON.stringify(currentBoardState));
    }

    // Função para criar um novo jogo
    function createNewGame() {
      let lugares = defaultBoardState.slice();
      lugares[0] = lugares[1] = lugares[2] = lugarEscolhidoPath;
      shuffleArray(lugares);
      currentBoardState = lugares; // Adicione esta linha para salvar o tabuleiro atualizado
      loadBoard(lugares);
      saveBoardState();
    }

    // Função para carregar o jogo salvo ou criar um novo jogo se não houver jogo salvo
    function loadGame() {
      const savedBoardState = localStorage.getItem('boardState');
      const lugares = savedBoardState ? JSON.parse(savedBoardState) : defaultBoardState.slice();

      if (!savedBoardState) {
        lugares[0] = lugares[1] = lugares[2] = lugarEscolhidoPath;
        shuffleArray(lugares);
        saveBoardState();
      }

      loadBoard(lugares);
    }

    // Função para gerar um novo tabuleiro
    function newGame() {
      currentBoardState = [];
      loadGame(); // Carrega o jogo salvo ou cria um novo jogo
    }

    // Chama a função para carregar o jogo ao carregar a página
    newGame();
    window.createNewGame = createNewGame;
    window.addEventListener('beforeunload', saveBoardState);
  </script>
</body>
</html>
